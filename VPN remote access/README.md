# VPN remote access

**Тонкости, названия внутрених продуктов и инструментов опущены, оставлена только основная информация**

**Данный материал не является примером методики тестирования, а только показывает используемые инструменты и подход к решению задачи!**

# Оглавление



# Схема стенда
![DUT](https://github.com/l-SK-l/My_projects/blob/main/VPN%20remote%20access/assets/VPN.png)

## Описание компонентов стенда
Описывается схема стенда с краткими пояснениям по каждому элементу

### Конфигурация стенда
Описываются: 
- Физические настройки машин
- Конфигурация VPN GW с описанием важных настроек
- Конфигурация сетевой части

## Описание взаимодействия
На нагрузочных машинах скриптами запускаются TAPs(слоны) которые динамически поднимают VPN туннели c GOST шифрованием для каждого виртуального пользователя, подключившись, пользователь начинает делать запросы пустой страницы с Nginx, тем самым контролиеруется его успешная работа. Основной целью тестирования является выявление максимального числа пользователей для конкретной аппаратно-програмной платформы, тестирование производительности, тестирование стабильноси и стрессовое тестирование. Отдельная машина VM с Win\Unix пользователем служит для проверки работоспособности, отладки, проверки производительности отдельных клиенских приложений и визуальной оценки работы удалённого доступа в различных режимах VPN.

# Конфигурационные файлы
Все конфигурационные файлы находят на VM Ansible\InfluxDB и автоматически раскладываются с помощью Ansible на каждую нагрузочную машину перед запуском каждой команды.

Запуск теста осуществляется с помощью переменных без необходимости редактирования конфигурационных файлов через ключь ansible `–extra-vars` или `-e`.

## YandexTank с Phantom
Указывается расположение файлов, команды Ansible для запуска и остановки теста

yandex_tank_config.j2 #Редактировать необходимо каждую группу

```
phantom:  #Генератор трафика по умолчанию
  enabled: true  
  address: "{{ addr }}:80"  #Адрес веб сервера
  uris:  #Путь к файлу
  - /{{ file }}.html
  phantom_http_entity: 20000M  #Макс размер скачиваемого файла
  load_profile:  #Профиль нагрузки
    load_type: instances  #Пользователи
    schedule: line(1,{{ line }},{{ line_time }}) const({{ const }},{{ const_time }})  #Расписание нагрузки для пользователей
rcheck:  #Проверка свободных ресурсов для генератора
  enabled: true
  mem_limit: 200  #Мин количество свободной оперативной памяти для работы
console:  #Вывод консоли при работе
  enabled: false
telegraf:  #Передача данных в telegraf для мониторинга
  enabled: false
```
### TAPs
Указывается расположение файлов, команды Ansible для запуска и остановки теста

run_taps.yaml #Редактировать необходимо каждую группу
```
- hosts: xxx
  vars:
   vpn_address: {{ vpn_addr }}  #Адрес VPN_GW
   pool_mask: {{ vpn_mask }}  #Маска пула адресов в настройках СД
   connections_per_user: {{ user }} #Количество установленных соединений для каждой нагрузочной VM
   connections_per_moment: {{ user_per_mom }}  #Количество соединений установленных одновременно
   connections_per_second: {{ user_per_sec }}  #Количество подключений в секунду
```
### Wget
Указывается расположение файлов, команды Ansible для запуска и остановки теста

Дополнительные скрипты для измерения производительности 
```
vars:
  srv_address: {{ srv_addr }} #Адресс веб сервера
  conn_num: {{ conn_num }} #Количество подключений с каждой нагрузочной машины
  websrv_file: {{ web_file }} #Загружаемый файл
  limit_rate: 285k #Ограничение скорости загрузки для каждого соединения
```
### Доп Команды
Указываются дополнительные команды Ansible, выключение\перезагрузка стенда, очистка логов и т.д.

# Описание тестов

Описывается каждый тест по шагам с действием и ожидаемым результатом

# Мониторинг

## Описание средств мониторинга
Для мониторинга аппаратных платформ и виртуальных машин используются средства и утилиты, входящие в состав операционной системы. 
Для Unix-образных операционных систем в качестве подобных утилит используются top, htop, vmstat, nload

Для сбора характеристик производительности компонентов системы предполагается использование следующих средств мониторинга:
-	SNMP
-	Telegraf
-	Grafana+InfluxDB

В качестве вспомогательных средств рекомендуется использовать netstat, ss, tcptrack, sysstat.
Краткое описание инструментов доступно в отдельной статьe wiki

## Описание мониторинга ресурсов
При проведении тестирования выполняется мониторинг следующих узлов:
-	VPN GW
-	Нагрузочные машины
-	Веб Сервер

Данные с VPN GW снимаются с помощью SMNP (или telegraf в случае необходимости дополнительных метрик), с нагрузочных машин и Веб сервера с помощью telegraf. Все данные собираются в единый мониторинг (Grafana+InfluxDB). 

В процессе тестирования снимаются журналы использования аппаратных ресурсов системы с периодичностью в 30 секунд

Для VPN GW включая
Процессор:
-	Утилизация процессора (в т.ч. отдельными процессами)
-	Средняя нагрузка на CPU в течении 1, 5 и 15 минут

Оперативная память:
-	Утилизация оперативной памяти (в т.ч. отдельными процессами)

Сеть:
-	Состояние интерфейсов
-	Утилизация интерфейсов

Дисковая система:
-	Средняя нагрузка на диск в течении 1, 5 и 15 минут в процентах
-	Состояние разделов /, /var, /etc

Другое:
-	Общее время работы
-	Количество подключенных клиентов к VPN
-	Статистика FW

Для Нагрузочных машин и Веб сервера из основных: Утилизация процессора, оперативной памяти, сетевых интерфейсов, а также количество активных соединений и воркеров на веб сервера и их состояние.

# Отчёт

Файл предполагает структурированное описание стенда и сводные результаты в шапке документа,  а так же свободное описание тестов с пояснениями, если того требуют результаты 

Шапка, отчёт, состав стенда, версии компонентов и настройки стенда должны быть зафиксированы в отчёте

Результаты измерений должны заноситься после каждого теста в сводную таблицу в шапке отчёта


